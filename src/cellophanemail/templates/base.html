<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}CellophoneMail - AI-Powered Email Protection{% endblock %}</title>
    
    <!-- CSRF Token -->
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <!-- TailwindCSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Hotwire Turbo -->
    <script type="module">
        import hotwiredTurbo from 'https://cdn.skypack.dev/@hotwired/turbo';
    </script>
    
    <!-- Hotwire Stimulus -->
    <script type="module">
        import { Application, Controller } from 'https://cdn.skypack.dev/@hotwired/stimulus';
        
        window.Stimulus = Application.start();
        
        // Base controller class
        window.Controller = Controller;
        
        // CSRF Token Helper
        document.addEventListener('DOMContentLoaded', () => {
            const csrfToken = document.querySelector('meta[name="csrf-token"]')?.content;
            
            // Add CSRF token to all forms
            document.querySelectorAll('form').forEach(form => {
                if (!form.querySelector('input[name="csrf_token"]') && csrfToken) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'csrf_token';
                    input.value = csrfToken;
                    form.appendChild(input);
                }
            });
            
            // Add CSRF header to fetch requests
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                let [url, options = {}] = args;
                
                // Add CSRF header for state-changing requests
                if (options.method && ['POST', 'PUT', 'PATCH', 'DELETE'].includes(options.method.toUpperCase())) {
                    options.headers = {
                        ...options.headers,
                        'X-CSRF-Token': csrfToken
                    };
                }
                
                return originalFetch(url, options);
            };
        });
    </script>
    
    {% block head %}{% endblock %}
</head>
<body class="h-full bg-white dark:bg-gray-900">
    {% block content %}{% endblock %}
    
    {% block scripts %}{% endblock %}
</body>
</html>